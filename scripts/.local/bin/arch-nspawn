#!/bin/bash -e
xauth_file="/tmp/arch-nspawn_xauth"

start() {
    if [[ ! -f "$xauth_file" ]]; then
        touch "$xauth_file"
        xauth nextract - "$DISPLAY" | sed -e 's/^..../ffff/' | xauth -f "$xauth_file" nmerge -
    fi
    machinectl start arch-nspawn
}

stop() {
    machinectl poweroff arch-nspawn
}

case $1 in
    start)
        start
        ;;
    stop)
        stop
        ;;
    start-gaming)
        mode boost
        systemctl --no-block start xow
        start
        ;;
    stop-gaming)
        stop
        systemctl --no-block stop xow
        mode normal
        latte-dock --replace & disown
        ;;
    login)
        machinectl login arch-nspawn
        ;;
    *)
        echo "usage: $0 {start|stop|start-gaming|stop-gaming|login}"
        exit 1
        ;;
esac
exit 0
